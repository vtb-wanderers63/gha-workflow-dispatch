name: 'Workflow Dispatch Trigger'
description: 'Triggers a workflow_dispatch event on another workflow and returns the run ID'
author: 'vtb-wanderers63'

inputs:
  owner:
    description: 'Owner of the repository where the workflow is located (defaults to current repo owner)'
    required: false
  repo:
    description: 'Repository name where the workflow is located (defaults to current repo)'
    required: false
  workflow_id:
    description: 'The ID or file name of the workflow to trigger'
    required: true
  ref:
    description: 'The git reference to run the workflow on (branch, tag, or SHA)'
    required: false
    default: ${{ github.ref }}
  workflow_run_name:
    description: 'The name of the workflow run for identification (optional)'
    required: false

outputs:
  run_id:
    description: 'The ID of the triggered workflow run'
    value: '${{ steps.workflow-dispatch.outputs.run_id }}'

runs:
  using: "composite"
  steps:
    - name: Generate GitHub App Token
      uses: actions/create-github-app-token@v1
      id: app-token
      with:
        app-id: ${{ inputs.app_id }}
        private-key: ${{ inputs.private_key }}
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'
        
    - name: Install dependencies
      shell: bash
      run: |
        cd ${{ github.action_path }}
        npm ci
        
    - name: Run workflow dispatch
      shell: bash
      id: workflow-dispatch
      run: node ${{ github.action_path }}/dist/index.js
      env:
        GITHUB_TOKEN: ${{ steps.app-token.outputs.token }}
        INPUT_OWNER: ${{ inputs.owner }}
        INPUT_REPO: ${{ inputs.repo }}
        INPUT_WORKFLOW_ID: ${{ inputs.workflow_id }}
        INPUT_REF: ${{ inputs.ref }}
        INPUT_WORKFLOW_RUN_NAME: ${{ inputs.workflow_run_name }}

branding:
  icon: 'play'
  color: 'blue'
